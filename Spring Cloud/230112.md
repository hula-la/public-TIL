###### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°„ í†µì‹  - Communication types

##### ğŸ” RestTemplate vs URLConnection

##### 	URLConnection

- URLConnectionì€ Connection poolì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- ì¿ í‚¤ ì œì–´ê°€ ë¶ˆê°€ëŠ¥
- íƒ€ì„ì•„ì›ƒ ì„¤ì • ë¶ˆê°€ëŠ¥
- URLConnection ê°ì²´ ì¬ì‚¬ìš© X

##### 	RestTemplate 

- Spring 3.0 ì´í›„ http(web).clientíŒ¨í‚¤ì§€ì— í¬í•¨
- HTTP ìš”ì²­ì„ Json, xml, Stringê³¼ ê°™ì€ ì‘ë‹µìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆëŠ” ë™ê¸°ì‹ í…œí”Œë¦¿ ë©”ì†Œë“œ API
- URLConnectionì€ Connection poolì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- ì¶”ìƒí™”ëœ HttpClientë¥¼ ì´ìš©í•´ êµ¬í˜„
- ResponseEntityì™€ Server to Server í†µì‹ ì„ í•˜ê±°ë‚˜ ì™¸ë¶€ API í˜¸ì¶œì‹œì— ì‚¬ìš©
- ë¹„ë™ê¸°ëŠ” AsyncRestTemplateë¡œ ì œê³µ

> ##### ğŸ¤” Connection Pool
>
> - ì§€ì†ì ì¸ ì—°ê²°/í•´ì œ ê³¼ì •ì„ ìµœì†Œí™”í•˜ê³  ì„±ëŠ¥ìƒì˜ ì´ì ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•¨
> - ì—°ê²° ì„¤ì •ì„ í•œë²ˆ í•œ í›„ ì§€ì†ì ìœ¼ë¡œ ê°™ì€ ì—°ê²°ì„ ê°€ì ¸ë‹¤ ì“°ê¸°ë§Œ í•˜ë©´ ë˜ë‹ˆ ìƒë‹¹íˆ ë¹ ë¦„
> - String Pool ê°œë…ê³¼ ìœ ì‚¬

---

###### RestTemplate ì‚¬ìš©

#### RestTemplate ì‚¬ìš©ë²•

- Applicationì—ì„œ RestTemplate ë¹ˆë“±ë¡

##### ë‹¬ë¼ì§€ëŠ” urlì— ë§ê²Œ ë‹¤ë¥¸ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ì— ìš”ì²­í•˜ê¸° ìœ„í•œ `@LoadBalanced` 

- ê¸°ì¡´ì—ëŠ” urlì™€ portë¥¼ ì •í™•í•˜ê²Œ ì ì–´ì¤˜ì•¼ í–ˆìŒ
- **ì´ì „:** `"http://127.0.0.1:8000/order-service/%s/orders"`
- **ì´í›„:** `"http://order-service/order-service/%s/orders"`

```java
@Bean
@LoadBalanced
public RestTemplate getRestTemplate() {
    return new RestTemplate();
}
```

---

###### FeignClient ì‚¬ìš©

#### FeignClient ì‚¬ìš©ë²•

- Spring Cloud Netflix ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
- `@FeignClient` Interface ìƒì„±
- UserServiceImpl.javeì—ì„œ Feign Client ì‚¬ìš©

---

###### Feign ì˜ˆì™¸ ì²˜ë¦¬

- ì˜ëª»ëœ ì£¼ì†Œë¡œ feign ìš”ì²­ì„ í•  ë•Œ 400 ì—ëŸ¬ê°€ ë°œìƒí•´ì•¼ í•˜ëŠ”ë°, 500 ì—ëŸ¬ê°€ ë°œìƒ

##### ë¡œê·¸ ì¶œëŸ­

- Applicationì— ë‹¤ìŒ ë¹ˆì„ ì¶”ê°€í•˜ë©´ ìì„¸í•œ ë¡œê·¸ ì¶œë ¥

```java
@Bean
public Logger.Level feignLoggerLevel() {
    return Logger.Level.FULL;
}
```

---

###### ErrorDecoderë¥¼ ì´ìš©í•œ ì˜ˆì™¸ ì²˜ë¦¬

- ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ í•¸ë“¤ë§

```java
@RequiredArgsConstructor
@Component
public class FeignErrorDecoder implements ErrorDecoder {
    private final Environment env;

    @Override
    public Exception decode(String methodKey, Response response) {
        switch (response.status()) {
            case 400:
                break;
            case 404:
                if (methodKey.contains("getOrders")) {
                    return new ResponseStatusException(HttpStatus.valueOf(response.status()),
                            env.getProperty("order_service.exception.orders_is_empty"));
                }
                break;
            default:
                return new Exception(response.reason());
        }
        return null;
    }
}
```

