# ğŸ¤” #11 ì„œë²„ê°€ ë‹¤ìš´ëœë‹¤ëŠ”ê²Œ ë¬´ì—‡ì¼ê¹Œ? #11

### ê°œìš”

 í”íˆ "ì„œë²„ê°€ ë‹¤ìš´ëë‹¤", "ì„œë²„ê°€ í„°ì¡Œë‹¤" ë¼ëŠ” í‘œí˜„ì„ ë§ì´ ì‚¬ìš©í•´ì™”ë‹¤.  ê³¼ë¶€í•˜ê°€ ê±¸ë¦¬ë©´ ì„œë²„ê°€ ë‹¤ìš´ëœë‹¤ ë¼ëŠ” ê²ƒì„ ê·¸ëƒ¥ ê³µì‹í™”í•´ì„œ ì´í•´í•´ì™”ëŠ”ë°, ì–´ë–¤ ì´ìœ ë¡œ ì„œë²„ê°€ í„°ì§€ëŠ”ì§€ ê°‘ìê¸° ì˜ë¬¸ì´ ë“¤ì–´ì„œ ì´ ì£¼ì œë¥¼ ì„ íƒí•´ë´¤ë‹¤. ì´ ì£¼ì œë¡œ ì˜ë¬¸ì„ ê°€ì§€ê²Œ ëœ ê²ƒì€ ì–¼ë§ˆì „ì— ã……ã„±ë‹˜í•œí…Œ ë“¤ì€ ì´ì•¼ê¸°ë¥¼ ë“£ê³  ë‚˜ì„œ ì˜€ë‹¤. ã……ã„±ë‹˜ íšŒì‚¬ì—ì„œ ìš´ì˜ ì¤‘ì¸ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì— íŠ¸ë˜í”½ì´ ë§ì´ ëª°ë ¤ì„œ ì„œë²„ê°€ ì‰½ê²Œ í„°ì§€ëŠ” ë¬¸ì œë¥¼ ê²ªê³  ìˆì–´ì„œ, ì´ë¥¼ í•´ê²° í•˜ê¸° ìœ„í•´ ì ìš©í•˜ê³  ìˆëŠ” ì†”ë£¨ì…˜ì— ëŒ€í•œ ì´ì•¼ê¸°ì˜€ë‹¤. ì´ ì´ì•¼ê¸°ë¥¼ ë“¤ì—ˆì„ ë•Œ ë‚˜ëŠ” ì €ë²ˆì— ìš°í˜• ìœ íŠœë¸Œì—ì„œ ë´¤ë˜ ì„ ì°©ìˆœ ì²˜ë¦¬ ê¸°ëŠ¥ì— ëŒ€í•œ ì˜ìƒì´ ë– ì˜¬ëë‹¤. ìš”ì•½í•´ì„œ ì„¤ëª…í•˜ìë©´ HTTP ìš”ì²­ì˜ timeoutì„ ë§‰ê¸° ìœ„í•´ redisì˜ sorted setì— userIdë¥¼ ì €ì¥í•¨ìœ¼ë¡œì¨, ìê¸° ì°¨ë¡€ê°€ ëì„ ë•Œ ì›¹ì†Œì¼“ì„ í†µí•´ ìˆœì°¨ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•˜ê²Œ í•˜ëŠ” ë°©ë²•ì´ì—ˆë‹¤. ã……ã„±ë‹˜ì˜ ê²½ìš°ì—ì„œë„ ì´ ê¸°ìˆ ì„ ì ìš©í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ ìƒê°í–ˆì§€ë§Œ, ì´ ë¬¸ì œìƒí™©ì— ëŒ€í•œ ëª…í™•í•œ ì†”ë£¨ì…˜ì´ ë  ìˆ˜ ìˆì„ì§€ì— ëŒ€í•´ì„  í™•ì‹ ì´ ë“¤ì§€ ì•Šì•˜ë‹¤. HTTPì˜ timeout ìœ¼ë¡œ ìš”ì²­ì„ ì œëŒ€ë¡œ ë°›ì§€ ëª»í•˜ëŠ” ê²ƒë„ ì„œë²„ê°€ í„°ì¡Œë‹¤ë¼ê³  í‘œí˜„í•˜ëŠ”ê²Œ ë§ì„ê¹Œ? ë¼ëŠ” ì˜ë¬¸ì´ ë“¤ì—ˆê³ , ë§Œì•½ ìš”ì²­ì´ ë§ì€ ê±° ìì²´ë¡œ ì¸í•´ ì¬ê¸°ë™ì´ í•„ìš”í•œ ìƒíƒœì¸ "ì„œë²„ í„°ì§" ì´ ë˜ì—ˆë‹¤ë©´ ì´ ì†”ë£¨ì…˜ì€ ìœ íš¨í•˜ì§€ ì•Šì„ ê²ƒì´ì—ˆê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ë¦¬ê³  ë‚œ ì—¬ê¸°ì„œ ì˜ë¬¸ì´ ë“¤ì—ˆë‹¤. ìš”ì²­ì´ ë§ì€ ê±°ë¡œ ì¸í•´ ì–´ë–»ê²Œ ì¬ê¸°ë™ì´ í•„ìš”í•œ "ì„œë²„ í„°ì§" ìƒíƒœê°€ ë˜ëŠ” ê²ƒì¼ê¹Œ? í•œ ë²ˆ ìƒê°í•´ë³´ì•˜ë‹¤.



### ë©”ëª¨ë¦¬ ê³¼ë¶€í•˜ (ì¼ëª… OOM)

 ì²˜ìŒ ìƒê°ë‚œ ê±´ OOMì´ë‹¤. cs ë‹¨ê³¨ ì§ˆë¬¸ì¸ error, exception ì˜ ì°¨ì´ê°€ ë– ì˜¬ëê¸° ë•Œë¬¸ì¸ë°, ì—¬ê¸°ì„œ errorëŠ” ì„œë²„ ì¹˜ëª…ì ì¸ ë¬¸ì œë¡œ jvmì˜ ë„ì›€ì´ í•„ìš”í•œ ë¬¸ì œì´ë©° ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ì˜ ì¬ê¸°ë™ì´ í•„ìš”í•˜ë‹¤ê³  ì•Œê³  ìˆë‹¤. ê·¸ë¦¬ê³  ì´ ì¤‘ì— í•œ ì˜ˆì‹œê°€ OOMì´ë‹¤. ì´ë¥¼ í†µí•´ ì¶”ì¸¡í•´ë³¸ ê²ƒì€ ë§ì€ ì‚¬ìš©ìì˜ ìš”ì²­ìœ¼ë¡œ ì¸í•´ ë§ì€ ë©”ëª¨ë¦¬ê°€ ë°œìƒí•˜ì—¬ OOMì´ ë°œìƒí•´ì„œ ì„œë²„ê°€ í„°ì§„ ê²ƒì´ ì•„ë‹ê¹Œ,,? ìƒê°í–ˆë‹¤. ìŠ¤ë ˆë“œ í’€ì„ ì ì ˆí•˜ê²Œ ì„¤ì •í•˜ê³  ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì ì ˆí•˜ê²Œ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ OOMì´ ëœ ë°œìƒí•˜ì§€ ì•Šì„ê¹Œ..?



### CPU ì‚¬ìš©ëŸ‰ì€ ê³¼ì—° ì„œë²„ ë‹¤ìš´ì— ì˜í–¥ì„ ë¯¸ì¹ ê¹Œ?

CPU ì‚¬ìš©ë¥ ì´ 100%ì— ë„ë‹¬ëë‹¤ê³  í•˜ë©´ ì„œë²„ì— ë¬´ìŠ¨ í°ì¼ ë‚œê±° ì²˜ëŸ¼ ë“¤ë¦°ë‹¤. ê·¸ëŸ°ë° í”„ë¦¬í‹°ì–´ì—ì„œ nGrinderë¡œ ë¶€í•˜í…ŒìŠ¤íŠ¸ë¥¼ í–ˆì„ ë•Œ CPUì˜ ì‚¬ìš©ë¥ ì´ 100%ì— ë„ë‹¬í•´ë„ ì„œë²„ê°€ ë‹¤ìš´ë˜ì§€ ì•Šì•˜ë‹¤. ë§ì€ ìŠ¤ë ˆë“œê°€ ì‹œë¶„í•  ë°©ì‹ìœ¼ë¡œ ë™ì‹œì— (ì‹¤ì œë¡œëŠ” ë™ì‹œê°€ ì•„ë‹ˆì§€ë§Œ) ì‹¤í–‰ë˜ì–´ CPUì˜ ì‚¬ìš©ë¥ ì´ ì¦ê°€ë˜ì—ˆì§€ë§Œ, ìš”ì²­ì˜ ì§€ì—°ì´ ë°œìƒí–ˆì„ ë¿ ì„œë²„ì˜ ì¬ê¸°ë™ì´ í•„ìš”í•œ "ì„œë²„ í„°ì§" ìƒíƒœëŠ” ë˜ì§€ ì•Šì•˜ë˜ ê²ƒì´ë‹¤. CPU í•œê³„ì—ì„œ ì˜¤ë²„ëœ ìŠ¤ë ˆë“œë“¤ì€ suspendê°€ ë˜ê±°ë‚˜ ì–´ì§¸ì €ì§¸,, ë˜ì–´ì„œ ìš”ì²­ì˜ ì§€ì—°ì´ ë°œìƒí•˜ê±°ë‚˜ ì•„ì˜ˆ ê±°ë¶€ê°€ ë°œìƒë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì„œë²„ ë‹¤ìš´ì´ ë°œìƒí•œ ê±°ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ëŠ” ìˆì§€ë§Œ, ìš”ì²­ì´ ì¤„ì–´ë“¤ë©´ ë°”ë¡œ ì •ìƒí™”ë  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ CPU ì‚¬ìš©ëŸ‰ì€ ì„œë²„ ë‹¤ìš´ì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤ê³  í•  ìˆ˜ ì—†ëŠ”ê±° ì•„ë‹ê¹Œ?



### í•˜ë“œì›¨ì–´ ë¬¸ì œ

ìœ„ì—ì„œ ì–¸ê¸‰í•œ ì†Œí”„íŠ¸ì›¨ì–´ì  ìš”ì¸ ì™¸ì—ë„ í•˜ë“œì›¨ì–´ì  ìš”ì¸ë„ ìˆì„ ê²ƒì´ë‹¤. ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ë‹¤ ë°œìƒë˜ëŠ” ì—´ë¡œ ì¸í•´ ë³´í˜¸ë¥¼ ìœ„í•´ ìë™ìœ¼ë¡œ ì…§ë‹¤ìš´ë˜ëŠ” ê²ƒì¼ ìˆ˜ë„ ìˆê³ , í•˜ë“œ ë“œë¼ì´ë¸Œê°€ ê°€ë“ ì°¨ì„œ ì„œë²„ê°€ ë‹¤ìš´ë  ìˆ˜ë„ ìˆê³ , ì´ ì™¸ì—ë„ ë‹¤ì–‘í•œ í•˜ë“œì›¨ì–´ì  ìš”ì¸ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ì´ ê²½ìš°ì—ëŠ” í ,,, ëƒ‰ê°ê¸°ë¥¼ ì—´ì‹¬íˆ ë‹¤ëŠ” ë°©ë²•ì´ ìˆì„í…Œê³ ,,, ì´ê±´ ìš°ì„  íŒ¨ì“°~



### ê²°ë¡ 

ã……ã„±ë‹˜í•œí…Œ í™•ì¸í•´ë³´ë‹ˆ, timeoutì— ì˜í•œê²Œ ì•„ë‹ˆê³  ì¬ê¸°ë™ì´ í•„ìš”í•œ ìƒíƒœì¸ "ì„œë²„ ë‹¤ìš´"ì´ì—ˆë‹¤. ì´ ê²ƒì´ OOMì— ì˜í•œ ê²ƒì´ë¼ë©´ redisë¡œ í•´ê²°ì´ ì•ˆë  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤. ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ì§€ ì•ŠëŠ” ì´ìƒ ì•„ì§ê¹Œì§€ ê°ì´ í™• ì˜¤ì§„ ì•ŠëŠ”ë‹¤. ì´ëŸ° ìƒí™©ë“¤ì„ ë§ˆì£¼í•´ë³´ê³  ì§ì ‘ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ê³  ì‹¶ë‹¤. ë‹¤ìŒì— ê¸°íšŒë  ë•Œ ì ìš© ë° í…ŒìŠ¤íŠ¸í•´ë³´ë©´ì„œ ê³µë¶€í•´ë´ì•¼ê² ë‹¤.



# ğŸ“– CompletableFutureì— ê´€í•˜ì—¬ #12

### ê°œìš”

ë°°ë‹¬ í”„ë¡œì íŠ¸ì—ì„œ êµ¬ì¶•í•œ MSA ì•„í‚¤í…ì²˜ì—ëŠ” ê°€ê²Œ ì„œë²„ì™€ ê³„ì • ì„œë²„ê°€ ìˆë‹¤. ê°€ê²Œ ì„œë²„ì—ëŠ” ê°€ê²Œ ì¡°íšŒ ì„œë¹„ìŠ¤ê°€ ìˆëŠ”ë°, ê°€ê²Œ ì£¼ì¸ì˜ ì´ë¦„ì€ ê³„ì • ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ë‹¤. í˜„ì¬ëŠ” ì´ í†µì‹ ì„ ë™ê¸°ì ìœ¼ë¡œ êµ¬í˜„í•´ë†¨ë‹¤. í•˜ì§€ë§Œ ì´ëŸ° ë™ê¸°ì  í†µì‹  ë°©ë²•ì€ ë¸”ë¡í‚¹ì„ ìœ ë°œì‹œì¼œì„œ ì„±ëŠ¥ ì €í•˜ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„  Spring Fluxë¡œ ë¹„ë™ê¸°ì  í†µì‹ ìœ¼ë¡œ í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ í•˜ì§€ë§Œ, ì•„ì§ ì´ê±´ ì˜ ëª°ë¼ì„œ ì ì‹œ íŒ¨ìŠ¤í•´ë’€ë‹¤,, ê·¸ëŸ¬ë‹¤ CompletableFutureì— ê¶ê¸ˆì¦ì´ ìƒê²¨ì„œ ì´ì— ëŒ€í•´ ê³µë¶€ë¥¼ í•´ë³´ë ¤ê³  í•œë‹¤.



### Future ë€?

Java5ì— ì¶”ê°€ëœ ê²ƒìœ¼ë¡œ ë¹„ë™ê¸° ì‘ì—…ì— ëŒ€í•œ ê²°ê³¼ê°’ì„ ë°˜í™˜ì‹œí‚¨ë‹¤. í•˜ì§€ë§Œ ë‹¤ìŒì˜ í•œê³„ì ì„ ê°€ì§€ê³  ìˆë‹¤.

- ì™¸ë¶€ì—ì„œ ì™„ë£Œì‹œí‚¬ ìˆ˜ ì—†ê³ , getì˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •ìœ¼ë¡œë§Œ ì™„ë£Œ ê°€ëŠ¥

  > ì‘ì—…ì´ ì™„ë£Œë˜ì–´ ì½œë°±í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ì•¼ì§€ë§Œ ì™„ë£Œì‹œí‚¬ ìˆ˜ ìˆê³ , ì•„ë‹ˆë©´ get ë©”ì„œë“œ ìš”ì²­ ìì²´ì˜ íƒ€ì„ì•„ì›ƒìœ¼ë¡œë§Œ ìš”ì²­ì„ ë§Œë£Œì‹œí‚¬ ìˆ˜ ìˆë‹¤ëŠ” ë§ì´ ì•„ë‹ê¹Œ?

- ë¸”ë¡œí‚¹ ì½”ë“œ(get)ë¥¼ í†µí•´ì„œë§Œ ì´í›„ì˜ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ

- ì—¬ëŸ¬ Futureë¥¼ ì¡°í•©í•  ìˆ˜ ì—†ìŒ ex) íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³ , ì•Œë¦¼ì„ ë°œì†¡í•˜ëŠ” ë“±

- ì—¬ëŸ¬ ì‘ì—…ì„ ì¡°í•©í•˜ê±°ë‚˜ ì˜ˆì™¸ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŒ

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ Java8ì—ì„œ CompletableFutureê°€ ë“±ì¥í•˜ì˜€ë‹¤.

> í ,, ì•„ì§ì€ ì–´ë–¤ ì˜ë¯¸ì¸ì§€ ì•ˆ ì™€ë‹¿ëŠ”ë‹¤. 



### CompletableFuture ë€?

ê¸°ì¡´ì˜ Futureë¥¼ ê¸°ë°˜ì´ë©° ì™¸ë¶€ì—ì„œ ì™„ë£Œì‹œí‚¬ ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ì´ë‹¤. Futureì—ì„œëŠ” ë¶ˆê°€ëŠ¥í–ˆë˜ "ëª‡ ì´ˆ ì´ë‚´ì— ì‘ë‹µì´ ì•ˆ ì˜¤ë©´ ê¸°ë³¸ ê°’ì„ ë°˜í™˜í•œë‹¤"ì™€ ê°™ì€ ì‘ì—…ì´ ê°€ëŠ¥í•´ì§„ ê²ƒì´ë‹¤. ì¦‰, Futureì˜ ì§„í™”ëœ í˜•íƒœë¡œì¨ **ì™¸ë¶€ì—ì„œ ì‘ì—…ì„ ì™„ë£Œì‹œí‚¬ ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼ ì½œë°± ë“±ë¡ ë° Future ì¡°í•© ë“±ì´ ê°€ëŠ¥**í•˜ë‹¤.



### CompletableFutureì˜ ê¸°ëŠ¥ë“¤ ë° ì˜ˆì‹œì½”ë“œ

##### ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰

- runAsync

  - ë°˜í™˜ê°’ì´ ì—†ëŠ” ê²½ìš°
  - ë¹„ë™ê¸°ë¡œ ì‘ì—… ì‹¤í–‰ ì½œ

  ```java
  @Test
  void runAsync() throws ExecutionException, InterruptedException {
      CompletableFuture<Void> future = CompletableFuture.runAsync(() -> {
          System.out.println("Thread: " + Thread.currentThread().getName());
      });
  
      future.get();
      System.out.println("Thread: " + Thread.currentThread().getName());
  }
  
  ```

  => ë³„ë„ì˜ ì“°ë ˆë“œì—ì„œ futureê°€ ì‹¤í–‰ë¨

  > ë©”ì¸ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ì“°ë ˆë“œì™€ ë¹„ë™ê¸° ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ì“°ë ˆë“œê°€ ë‹¤ë¥´ë‹¤.

- supplyAsync

  - ë°˜í™˜ê°’ì´ ìˆëŠ” ê²½ìš°
  - ë¹„ë™ê¸°ë¡œ ì‘ì—… ì‹¤í–‰ ì½œ

  ```java
  @Test
  void supplyAsync() throws ExecutionException, InterruptedException {
  
      CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
          return "Thread: " + Thread.currentThread().getName();
      });
  
      System.out.println(future.get());
      System.out.println("Thread: " + Thread.currentThread().getName());
  }
  ```

  > ìŒ ë¹„ë™ê¸° ì‘ì—…ì´ë¼ê³  í•´ì„œ ìˆœì„œì— ìƒê´€ì—†ì´ ë’¤ì—êº¼ê°€ ë¨¼ì € ì²˜ë¦¬ê°€ ë˜ëŠ”ì§€ ì•Œì•˜ì§€ë§Œ ì§ì ‘ ì½”ë“œë¥¼ ëŒë ¤ë³´ë‹ˆ ë¸”ë¡œí‚¹ì´ ë˜ë„¤? ìš°ì„  ê³„ì† ê³µë¶€í•´ë³´ì..
  >
  > System.out.println ëŠ” ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì´ë‹¤. ë‚´ê°€ ì›í•˜ëŠ”ëŒ€ë¡œ í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•´ì•¼í•œë‹¤.
  > ```java
  > @Test
  > void supplyAsync() {
  > 
  >     CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
  >         try {
  >             // ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œì´ë‚˜ ë³µì¡í•œ ì—°ì‚° ë“±ì˜ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ ê°€ì •
  >             Thread.sleep(1000);
  >         } catch (InterruptedException e) {
  >             throw new IllegalStateException(e);
  >         }
  >         return "Thread: " + Thread.currentThread().getName();
  >     });
  > 
  >     // CompletableFuture ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ì‹¤í–‰ë˜ëŠ” ì½œë°± ì„¤ì •
  >     future.thenAccept(result -> {
  >         System.out.println(result);
  >     });
  > 
  >     System.out.println("Thread: " + Thread.currentThread().getName());
  > }
  > ```
  >
  > ì´ëŸ° ë¹„ë™ê¸°ì  ì‘ì—…ì´ í•„ìš”í•  ë•Œ, ì¨ë¨¹ì–´ë³´ì¥



##### ì‘ì—… ì½œë°±

- thenApply

  - ë°˜í™˜ ê°’ì„ ë°›ì•„ì„œ ë‹¤ë¥¸ ê°’ì„ ë°˜í™˜í•¨
  - í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ Functionì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ

  ```java
  @Test
  void thenApply() throws ExecutionException, InterruptedException {
      CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
          return "Thread: " + Thread.currentThread().getName();
      }).thenApply(s -> {
          return s.toUpperCase();
      });
  
      System.out.println(future.get());
  }
  ```

- thenAccept

  - ë°˜í™˜ ê°’ì„ ë°›ì•„ ì²˜ë¦¬í•˜ê³  ê°’ì„ ë°˜í™˜í•˜ì§€ ì•ŠìŒ
  - í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ Consumerë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ

  ```java
  @Test
  void thenAccept() throws ExecutionException, InterruptedException {
      CompletableFuture<Void> future = CompletableFuture.supplyAsync(() -> {
          return "Thread: " + Thread.currentThread().getName();
      }).thenAccept(s -> {
          System.out.println(s.toUpperCase());
      });
  
      future.get();
  }
  ```

- thenRun

  - ë°˜í™˜ ê°’ì„ ë°›ì§€ ì•Šê³  ë‹¤ë¥¸ ì‘ì—…ì„ ì‹¤í–‰
  - í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ Runnableì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ

  ```java
  @Test
  void thenRun() throws ExecutionException, InterruptedException {
      CompletableFuture<Void> future = CompletableFuture.supplyAsync(() -> {
          return "Thread: " + Thread.currentThread().getName();
      }).thenRun(() -> {
          System.out.println("Thread: " + Thread.currentThread().getName());
      });
  
      future.get();
  }
  ```

  

##### ì‘ì—… ì¡°í•©

- thenCompose

  - ë‘ ì‘ì—…ì´ ì´ì–´ì„œ ì‹¤í–‰í•˜ë„ë¡ ì¡°í•©í•˜ë©°, ì•ì„  ì‘ì—…ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
  - í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ Functionì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ

  ```java
  @Test
  void thenCompose() throws ExecutionException, InterruptedException {
      CompletableFuture<String> hello = CompletableFuture.supplyAsync(() -> {
          return "Hello";
      });
  
      // Future ê°„ì— ì—°ê´€ ê´€ê³„ê°€ ìˆëŠ” ê²½ìš°
      CompletableFuture<String> future = hello.thenCompose(this::mangKyu);
      System.out.println(future.get());
  }
  
  private CompletableFuture<String> mangKyu(String message) {
      return CompletableFuture.supplyAsync(() -> {
          return message + " " + "MangKyu";
      });
  }
  ```

- thenCombine

  - ë‘ ì‘ì—…ì„ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³ , ë‘˜ ë‹¤ ì™„ë£Œë˜ì—ˆì„ ë•Œ ì½œë°±ì„ ì‹¤í–‰í•¨
  - í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ Functionì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ

  ```java
  @Test
  void thenCombine() throws ExecutionException, InterruptedException {
      CompletableFuture<String> hello = CompletableFuture.supplyAsync(() -> {
          return "Hello";
      });
  
      CompletableFuture<String> mangKyu = CompletableFuture.supplyAsync(() -> {
          return "MangKyu";
      });
  
      CompletableFuture<String> future = hello.thenCombine(mangKyu, (h, w) -> h + " " + w);
      System.out.println(future.get());
  }
  ```

> ì´ê±¸ ì˜ ì´ìš©í•œë‹¤ë©´, ê°€ê²Œ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒì—ì„œ ê° ê°€ê²Œì—ì„œ ì‚¬ì¥ ì´ë¦„ ì¡°íšŒë¥¼ ë…ë¦½ì ìœ¼ë¡œ í•  ìˆ˜ ìˆì„ë¼ë‚˜? 

- allOf

  - ì—¬ëŸ¬ ì‘ì—…ë“¤ì„ ë™ì‹œì— ì‹¤í–‰í•˜ê³ , ëª¨ë“  ì‘ì—… ê²°ê³¼ì— ì½œë°±ì„ ì‹¤í–‰í•¨

  ```java
  @Test
  void allOf() throws ExecutionException, InterruptedException {
      CompletableFuture<String> hello = CompletableFuture.supplyAsync(() -> {
          return "Hello";
      });
  
      CompletableFuture<String> mangKyu = CompletableFuture.supplyAsync(() -> {
          return "MangKyu";
      });
  
      List<CompletableFuture<String>> futures = List.of(hello, mangKyu);
  
      CompletableFuture<List<String>> result = CompletableFuture.allOf(futures.toArray(new CompletableFuture[futures.size()]))
              .thenApply(v -> futures.stream().
                      map(CompletableFuture::join).
                      collect(Collectors.toList()));
  
      result.get().forEach(System.out::println);
  }
  ```

- anyOf

  - ì—¬ëŸ¬ ì‘ì—…ë“¤ ì¤‘ì—ì„œ ê°€ì¥ ë¹¨ë¦¬ ëë‚œ í•˜ë‚˜ì˜ ê²°ê³¼ì— ì½œë°±ì„ ì‹¤í–‰í•¨

  ```java
  @Test
  void anyOf() throws ExecutionException, InterruptedException {
      CompletableFuture<String> hello = CompletableFuture.supplyAsync(() -> {
          try {
              Thread.sleep(1000L);
          } catch (InterruptedException e) {
              throw new RuntimeException(e);
          }
  
          return "Hello";
      });
  
      CompletableFuture<String> mangKyu = CompletableFuture.supplyAsync(() -> {
          return "MangKyu";
      });
  
      CompletableFuture<Void> future = CompletableFuture.anyOf(hello, mangKyu).thenAccept(System.out::println);
      future.get();
  }
  ```



##### ì˜ˆì™¸ ì²˜ë¦¬

- exeptionally

  - ë°œìƒí•œ ì—ëŸ¬ë¥¼ ë°›ì•„ì„œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•¨
  - í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ Functionì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ

  ```java
  @ParameterizedTest
  @ValueSource(booleans =  {true, false})
  void exceptionally(boolean doThrow) throws ExecutionException, InterruptedException {
      CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
          if (doThrow) {
              throw new IllegalArgumentException("Invalid Argument");
          }
  
          return "Thread: " + Thread.currentThread().getName();
      }).exceptionally(e -> {
          return e.getMessage();
      });
  
      System.out.println(future.get());
  }
  
  java.lang.IllegalArgumentException: Invalid Argument
  // Thread: ForkJoinPool.commonPool-worker-19
  ```

- handle, handleAsync

  - (ê²°ê³¼ê°’, ì—ëŸ¬)ë¥¼ ë°˜í™˜ë°›ì•„ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ì™€ ì•„ë‹Œ ê²½ìš° ëª¨ë‘ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ
  - í•¨ìˆ˜í˜• ì¸í„°í˜ì´ìŠ¤ BiFunctionì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ

  ```java
  @ParameterizedTest
  @ValueSource(booleans =  {true, false})
  void handle(boolean doThrow) throws ExecutionException, InterruptedException {
      CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
          if (doThrow) {
              throw new IllegalArgumentException("Invalid Argument");
          }
  
          return "Thread: " + Thread.currentThread().getName();
      }).handle((result, e) -> {
          return e == null
                  ? result
                  : e.getMessage();
      });
  
      System.out.println(future.get());
  }
  ```

  



### ê²°ë¡ 

ë‹¤ì‹œ ìƒê°í•´ë³´ë‹ˆê¹Œ ê°€ê²Œë‚˜ ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•  ë•Œ streamì„ ì´ìš©í•´ì„œ ê° ì›ì†Œë§ˆë‹¤ ì‚¬ëŒì˜ ì´ë¦„ì„ ì¡°íšŒí•˜ëŠ”ê±¸ ì„œë¡œ ë…ë¦½ì ìœ¼ë¡œ í•˜ë ¤ë©´ streamì˜ parallel APIë¥¼ ì‚¬ìš©í•´ë„ ë  ê²ƒ ê°™ë‹¤. ì ì‹œ ê¹Œë¨¹ê³  ìˆì—ˆë‹¤...ã… í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ìƒê¸°ëŠ” ë¬¸ì œê°€ ëª¨ë“  ì‚¬ìš©ìì˜ ì´ë¦„ì— ëŒ€í•´ ì¼ì¼ì´ ìš”ì²­ì„ í•˜ë©´ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ê²ƒì´ì—ˆë‹¤. ì•„ì˜ˆ í•œë²ˆì— ê·¸ ë¦¬ìŠ¤íŠ¸ì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  ì‚¬ìš©ìì˜ ì´ë¦„ì„ ìš”ì²­í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•´ì„œ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì„ ì¤„ì´ê±°ë‚˜ ìºì‹±ì„ ì´ìš©í•´ì„œ ì¡°íšŒ ì„±ëŠ¥ì„ ë†’ì´ëŠ” ë°©ë²•ì´ ìˆì„ ê²ƒ ê°™ë‹¤. ìš°ì„  ì´ê±´ ê³„ì† ê³µë¶€í•´ë³´ë©´ì„œ ë” ìƒê°í•´ë³´ì.

ê·¸ë˜ë„ ì´ ê¸°íšŒì— Future í´ë˜ìŠ¤ì— ëŒ€í•´ ê³µë¶€í•´ë´ì„œ ì¢‹ë‹¤. ë‹¤ì–‘í•œ ê²½ìš°ë¥¼ ìœ„í•œ APIê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—, ì ì ˆí•˜ê²Œ ì‚¬ìš©í•˜ë©´ ë˜ê² ë‹¤. 

