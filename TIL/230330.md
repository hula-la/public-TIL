## 리팩토링

#### Account 도메인

1. AccountMapper 추가

   ObjectMapper 없애고, AccountMapper와 Builder패턴을 사용해서 코드 중복&난잡도 최소화 + 책임 분리 + 일관성 유지 를 하려고 함.

2. MSA에서 account가 존재하는지 확인하기 위해서 어떻게 하는 것이 좋을까?

   1. accountId 데이터를 다른 마이크로 서비스들과 동기화하는 방법

      - JWT를 쓰는 장점이 없어짐
      - MQS 설치 및 운영으로 인해 발생하는 자원 소모, 성능 저하 가능성

   2. 필요할 때마다 account server 에서 확인

      - msa로 로드밸런싱하는 의미가 없어짐
      - account Service에 트래픽이 몰림

   3. api gateway에 캐싱하기

      - api gateway에서 JWT 유효성 확인할 때 accountId로 account 유무 확인

      - api gateway에서 검증된 accountId이므로 논리적 외래키로 사용하기

      - logout할 땐 캐싱 삭제

        



## 데이터의 무결성이란?

##### 상황

- 무결성이란 말을 무턱대고 많이 사용해왔음.
- 하지만, 정확한 의미를 말하라고 하면 말할 수 있을까,,?
- 제대로 알기 위해 찾아봄

##### 서칭

- 무결성이란 데이터의 정확성, 유효성, 일관성을 보장하는 것
- **유효성**: 사용자로 부터 값을 입력받을 때 정확한 값만 입력되도록 할 때 유용한 기능

- **정확성**: 중복이나 누락이 없는 상태를 뜻함
- **일관성**: 원인과 결과의 의미가 연속적으로 보장되어 변하지 않는 상태



## 마이크로서비스 통신을 위한 API를 추가해야 하는가?

##### 상황

- 기존엔 사용자의 정보를 담는 api가 존재했음
- msa를 적용하기 위해선 order 서비스에서 account 서비스로 사용자의 이름/전화번호 을 받아야 하는데, 기존의 api를 사용하면 필요없는 필드까지 받게되어, 필요없는 필드 매핑이 일어남.
- 하지만, 기존에 DTO를 반환하는 api가 있는데 nickname, tel에 대한 api를 추가하는게 과연 옳은가 에 대해서 고민이 생겼음.
- 찾아보다가 보게된게 GraphQL인데, 이건 자신이 필요로 하는 필드만을 쿼리를 이용해서 요청할 수 있다고 함. 서비스단에서는 어차피 매핑을 하기 때문에 통신 비용 절감 외에 달라지는게 있을까 싶은데, 한번 작동원리에 대해서 공부해보면 좋을 것 같다고 생각함.

<img src="https://blog.kakaocdn.net/dn/ce0uqx/btq4MBWABLn/8JL1GcBNazFsk8d6jVRP2k/img.png" alt="img" style="zoom:67%;" />
