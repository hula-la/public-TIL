## 샤딩을 할 때 왜 PK는 UUID를 사용해야 할까?

- 보통 샤딩 수는 2의 제곱수로 정한다.

  - 샤딩 수가 변경될 때 데이터의 이동이 최소화되기 때문이다. 

- pk를 정수형으로 사용하면 중복이 될 경우가 생길 수 있음.

  > 왜 중복이지?
  >
  > 우선 내가 생각하기엔, 새로운 데이터를 추가하기 위해선 기존에 몇개의 데이터가 있었는지 확인하고 다음 id를 생성해야 하는데, db가 분산되어 있기 때문에 바로 알지 못해서 랜덤값을 기준으로 그에 알맞는 db에 저장되는게 순서가 맞지 않나 생각한다.



---

## 쿼리 줄이기

##### 상황

- 주문할 때 메뉴와 옵션의 entity를 조회하기 위해 id로 하나하나 쿼리를 날렸음.
- 이에 따른 DB 통신의 증가로 인해 성능 저하가 발생할 수 있음.

##### 생각

- in query를 날려서 쿼리 갯수를 줄임
- 옵션과 join해서 옵션에 대한 쿼리도 1개로 합치려고 함.



## 동일하지 않은 영속성 컨텍스트에서 엔티티는 동일성을 가질까?

https://velog.io/@park2348190/JPA-Entity%EC%9D%98-equals%EC%99%80-hashCode

- 1차 캐시를 조기화한 후 다시 db에서 동일한 엔티티를 읽어오는 경우 다른 객체로 생성됨
